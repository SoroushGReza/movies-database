{% extends 'base.html' %}
{% load static %}

{% block content %}

<div class="messages-container">
    {% if messages %}
    {% for message in messages %}
    <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
        {{ message }}
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
    {% endfor %}
    {% endif %}
</div>


<div class="container-fluid profile-container">
    <div id="user-profile-bg">
        <div id="user-profile-bg-overlay"></div>

        <div class="row col-7 col-md-7 col-sm-12">
            <div class="user-profile-div">
                <h2 id="user-profile-header">User Profile</h2>
                <p class="user-info"><strong>Username: </strong>{{ user.username }}</p>
                <p class="user-info"><strong>E-mail: </strong>{{ user.email }}</p>
                <!--  Link to my reviews page  -->

                <div class="col-md-10">
                    <!-- Edit Prfofile Button -->
                    <a href="#" class="btn btn-primary" id="edit-profile-button">Edit Profile</a>

                    <!-- My Reviews Button -->
                    <a id="my-reviews-button" class="btn btn-primary" href="{% url 'movies:my_reviews' %}">My
                        Reviews</a>

                    <!-- Delete Account Button -->
                    <a href="#" class="btn btn-primary" id="delete-account-button" data-bs-toggle="modal"
                        data-bs-target="#deleteAccountModal">Delete Account</a>

                    <!-- Delete Account Modal -->
                    <div class="modal fade" id="deleteAccountModal" tabindex="-1"
                        aria-labelledby="deleteAccountModalLabel" aria-hidden="true">
                        <div class="modal-dialog">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="deleteAccountModalLabel">Delete Account</h5>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal"
                                        aria-label="Close"></button>
                                </div>
                                <div class="modal-body">
                                    <p>Are you sure you want to delete your account? All your data including
                                        your reviews will be lost. If you are sure type your password to verify
                                        and delete your account.</p>
                                    <form method="post" action="{% url 'movies:delete_account' %}">
                                        {% csrf_token %}
                                        <div class="form-group">
                                            <label for="{{ form.password.id_for_label }}">Password:</label>
                                            <input type="password" name="password" class="form-control"
                                                id="{{ form.password.id_for_label }}" autocomplete="new-password"/>
                                        </div>
                                        <div class="modal-footer">
                                            <button type="button" class="btn btn-secondary"
                                                data-bs-dismiss="modal">Close</button>
                                            <button type="submit" class="btn btn-danger">Delete Account</button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div id="edit-profile-form" style="display: none;">
                    <form method="post" enctype="multipart/form-data" class="mt-3">
                        {% csrf_token %}
                        <h4 class="form-headers">Update Email</h4>
                        <div class="form-group">
                            <input type="email" id="{{ profile_form.email.id_for_label }}"
                                name="{{ profile_form.email.name }}" class="form-control-profile"
                                placeholder="New email here.." value="{{ user.email }}">

                        </div>
                        <h4 id="change-password-header" class="form-headers">Change Password</h4>
                        <div class="form-group">
                            {% for field in password_form %}
                            <input placeholder="{{ field.label }}" type="{{ field.field.widget.input_type }}"
                                id="password-input-{{ forloop.counter }}" name="{{ field.name }}"
                                class="form-control-profile password-fields-custom value="{{ field.value|default_if_none:'' }}">
                            {% endfor %}
                        </div>
                        <button type="submit" class="btn btn-primary update-profile-button">Update Profile</button>
                    </form>
                </div>

            </div>
        </div>
    </div>
</div>

<script>
    // Hide messages after 5 seconds
    setTimeout(function () {
        const alertElements = document.querySelectorAll('.alert');
        if (alertElements) {
            alertElements.forEach((element) => {
                element.style.display = 'none';
            });
        }
    }, 5000);
</script>


{% endblock %}